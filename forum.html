<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NebChat â€¢ Forum</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&family=Pacifico&display=swap');

    body {
      margin: 0;
      font-family: 'Montserrat', sans-serif;
      background: #080d1a;
      color: #dfe4ff;
    }

    /* HEADER + MENÃœ */
    header {
      background: rgba(15, 20, 40, 0.7);
      backdrop-filter: blur(10px);
      padding: 18px 25px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid rgba(80, 100, 255, 0.25);
      box-shadow: 0 0 18px rgba(0, 162, 255, 0.25);
      position: sticky;
      top: 0;
      z-index: 50;
    }

    .logo-area {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .logo-title {
      font-family: 'Pacifico', cursive;
      font-size: 34px;
      font-weight: 400;
      color: #8ab4ff;
      text-shadow: 0 0 10px rgba(121, 169, 255, 0.9);
      letter-spacing: 0.5px;
    }

    .menu {
      display: flex;
      gap: 16px;
    }

    .menu a {
      color: #a8b4ff;
      text-decoration: none;
      font-weight: 500;
      font-size: 14px;
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid rgba(108, 99, 255, 0.3);
      background: rgba(255, 255, 255, 0.03);
      transition: 0.25s;
    }

    .menu a:hover {
      background: rgba(108, 99, 255, 0.25);
      box-shadow: 0 0 14px rgba(108, 99, 255, 0.5);
      color: #ffffff;
    }

    @media (max-width: 700px) {
      header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      .menu {
        flex-wrap: wrap;
      }
    }

    /* SAYFA */
    .page {
      max-width: 1100px;
      margin: 30px auto 60px;
      padding: 0 16px;
    }

    .page-title {
      font-size: 26px;
      font-weight: 600;
      color: #bcd2ff;
      text-shadow: 0 0 18px rgba(120, 140, 255, 0.8);
      margin-bottom: 6px;
    }

    .page-subtitle {
      font-size: 14px;
      color: #a3aedf;
      opacity: 0.9;
      margin-bottom: 24px;
    }

    /* YENÄ° KONU FORMU */
    .new-topic-box {
      background: rgba(20, 25, 50, 0.7);
      border-radius: 18px;
      padding: 18px 16px;
      border: 1px solid rgba(108, 99, 255, 0.35);
      box-shadow: 0 0 22px rgba(80, 70, 230, 0.5);
      margin-bottom: 26px;
    }

    .new-topic-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 10px;
      color: #d6e0ff;
    }

    .form-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .form-row input {
      flex: 1;
      min-width: 160px;
      padding: 9px;
      border-radius: 10px;
      border: 1px solid rgba(108, 99, 255, 0.4);
      background: rgba(255, 255, 255, 0.08);
      color: #ffffff;
      outline: none;
      font-size: 13px;
    }

    .form-row input:focus,
    textarea:focus {
      border-color: rgba(138, 127, 255, 0.9);
      box-shadow: 0 0 15px rgba(138, 127, 255, 0.7);
    }

    textarea {
      width: 100%;
      min-height: 90px;
      max-height: 220px;
      border-radius: 12px;
      border: 1px solid rgba(108, 99, 255, 0.35);
      background: rgba(255, 255, 255, 0.08);
      padding: 10px;
      color: white;
      outline: none;
      font-size: 14px;
      resize: vertical;
      margin-bottom: 8px;
    }

    .btn-main {
      padding: 9px 18px;
      border-radius: 10px;
      border: 1px solid rgba(108, 99, 255, 0.7);
      background: rgba(108, 99, 255, 0.5);
      color: #e0e4ff;
      font-size: 14px;
      cursor: pointer;
      transition: 0.25s;
    }

    .btn-main:hover {
      background: rgba(108, 99, 255, 0.7);
      box-shadow: 0 0 20px rgba(108, 99, 255, 0.85);
    }

    .info-text {
      font-size: 11px;
      color: #a7b1f0;
      margin-top: 6px;
    }

    /* KONU LÄ°STESÄ° */
    .topics-list {
      margin-top: 20px;
    }

    .topic-link {
      text-decoration: none;
      color: inherit;
      display: block;
    }

    .topic-item {
      background: rgba(14, 18, 40, 0.95);
      border-radius: 16px;
      padding: 14px 13px;
      margin-bottom: 10px;
      border: 1px solid rgba(108, 99, 255, 0.3);
      box-shadow: 0 0 18px rgba(88, 80, 255, 0.25);
      transition: 0.25s;
      cursor: pointer;
    }

    .topic-item:hover {
      border-color: rgba(108, 99, 255, 0.7);
      box-shadow: 0 0 24px rgba(88, 80, 255, 0.4);
      transform: translateY(-1px);
    }

    .topic-header-row {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 4px;
      align-items: center;
    }

    .topic-title {
      font-size: 15px;
      font-weight: 600;
      color: #dfe4ff;
    }

    .topic-nick {
      font-size: 12px;
      color: #aeb7ff;
    }

    .topic-time {
      font-size: 11px;
      color: #8f9ae0;
      text-align: right;
    }

    .topic-message {
      font-size: 13px;
      color: #cfd7ff;
      margin-top: 4px;
      white-space: pre-wrap;
    }

    .topic-meta-line {
      margin-top: 6px;
      font-size: 11px;
      color: #9ea7f0;
      opacity: 0.95;
    }

    .no-topics {
      font-size: 13px;
      color: #9da5dd;
      margin-top: 10px;
    }

    footer {
      margin-top: 40px;
      padding: 20px;
      text-align: center;
      font-size: 13px;
      color: #8189c4;
      border-top: 1px solid rgba(80, 100, 255, 0.25);
    }
  </style>
</head>

<body>

<header>
  <div class="logo-area">
    <a href="index.html" style="display:flex;align-items:center;gap:14px;text-decoration:none;">
      <div class="logo-title">NebChat</div>
    </a>
  </div>

  <nav class="menu">
    <a href="index.html">Ana Sayfa</a>
    <a href="forum.html">Forum</a>
    <a href="login.html">GiriÅŸ Yap</a>
    <a href="profile.html">Profilim</a>
  </nav>
</header>

<main class="page">
  <h1 class="page-title">NebChat Anonim Forum</h1>
  <p class="page-subtitle">
    GiriÅŸ yapmak zorunlu deÄŸil. Bir takma ad (nick) seÃ§, baÅŸlÄ±ÄŸÄ±nÄ± ve mesajÄ±nÄ± yaz, gÃ¶nder.
    Herkes bu sayfadan yazÄ±lanlarÄ± gÃ¶rebilir.
  </p>

  <!-- YENÄ° KONU FORMU -->
  <section class="new-topic-box">
    <div class="new-topic-title">Yeni Konu AÃ§</div>

    <div class="form-row">
      <input type="text" id="nickInput" placeholder="Takma adÄ±n (Ã¶r: Nebride)">
      <input type="text" id="titleInput" placeholder="Konu baÅŸlÄ±ÄŸÄ±">
    </div>

    <textarea id="messageInput" placeholder="MesajÄ±nÄ± yaz..."></textarea>

    <button class="btn-main" id="sendBtn">Konuyu GÃ¶nder</button>

    <div class="info-text">
      LÃ¼tfen kiÅŸisel bilgilerini paylaÅŸma. Bu forum tamamen anonimdir. Mesajlar Firebase Firestoreâ€™da saklanÄ±r
      ve herkes tarafÄ±ndan gÃ¶rÃ¼lebilir.
    </div>
  </section>

  <!-- KONU LÄ°STESÄ° -->
  <section class="topics-list">
    <h2 style="font-size:18px;margin-bottom:10px;color:#c8d2ff;">Son Konular</h2>
    <div id="topicsContainer">
      <p class="no-topics">HenÃ¼z konu aÃ§Ä±lmamÄ±ÅŸ. Ä°lk konuyu sen aÃ§ ðŸŽ‰</p>
    </div>
  </section>

  <footer>
    NebChat anonim forum â€¢ Bu sayfa deneme aÅŸamasÄ±ndadÄ±r. Ä°Ã§erik tamamen kullanÄ±cÄ±larÄ±n sorumluluÄŸundadÄ±r.
  </footer>
</main>

<!-- Firebase + Firestore (modÃ¼ler) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import {
    getFirestore,
    collection,
    addDoc,
    serverTimestamp,
    query,
    orderBy,
    onSnapshot
  } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  // nebchat2 projenin config'i
  const firebaseConfig = {
    apiKey: "AIzaSyBAwFSe0pud59OXpx1G5hQO9opA1f7Eg9Y",
    authDomain: "nebchat2.firebaseapp.com",
    projectId: "nebchat2",
    storageBucket: "nebchat2.firebasestorage.app",
    messagingSenderId: "46979426016",
    appId: "1:46979426016:web:fd1fbe341fff6970ae9285"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const nickInput = document.getElementById("nickInput");
  const titleInput = document.getElementById("titleInput");
  const messageInput = document.getElementById("messageInput");
  const sendBtn = document.getElementById("sendBtn");
  const topicsContainer = document.getElementById("topicsContainer");

  // Yeni konu gÃ¶nderme
  sendBtn.addEventListener("click", async () => {
    const nick = nickInput.value.trim();
    const title = titleInput.value.trim();
    const message = messageInput.value.trim();

    if (!nick || !title || !message) {
      alert("LÃ¼tfen nick, baÅŸlÄ±k ve mesajÄ± doldur.");
      return;
    }

    try {
      await addDoc(collection(db, "posts"), {
        nick,
        title,
        message,
        createdAt: serverTimestamp(),
        replyCount: 0,
        lastReplyAt: null
      });

      // temizle
      messageInput.value = "";
      titleInput.value = "";
      // nick'i temizlemiyoruz
    } catch (e) {
      console.error("Konu eklenirken hata:", e);
      alert("Konu eklenirken bir hata oluÅŸtu.");
    }
  });

  // KonularÄ± Firestore'dan canlÄ± olarak dinle
  const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));

  onSnapshot(q, (snapshot) => {
    if (snapshot.empty) {
      topicsContainer.innerHTML = '<p class="no-topics">HenÃ¼z konu aÃ§Ä±lmamÄ±ÅŸ. Ä°lk konuyu sen aÃ§ ðŸŽ‰</p>';
      return;
    }

    topicsContainer.innerHTML = "";

    snapshot.forEach((docSnap) => {
      const data = docSnap.data();
      const postId = docSnap.id;

      const item = document.createElement("a");
      item.className = "topic-link";
      item.href = `topic.html?id=${encodeURIComponent(postId)}`;

      const wrapper = document.createElement("div");
      wrapper.className = "topic-item";

      const headerRow = document.createElement("div");
      headerRow.className = "topic-header-row";

      const left = document.createElement("div");
      left.innerHTML = `
        <div class="topic-title">${data.title || "BaÅŸlÄ±ksÄ±z"}</div>
        <div class="topic-nick">Yazan: ${data.nick || "Anonim"}</div>
      `;

      const right = document.createElement("div");
      right.className = "topic-time";

      let timeText = "";
      if (data.createdAt && data.createdAt.toDate) {
        const d = data.createdAt.toDate();
        timeText = d.toLocaleString("tr-TR", {
          day: "2-digit",
          month: "2-digit",
          hour: "2-digit",
          minute: "2-digit"
        });
      }

      right.textContent = timeText || "";

      headerRow.appendChild(left);
      headerRow.appendChild(right);

      const msg = document.createElement("div");
      msg.className = "topic-message";
      msg.textContent = data.message || "";

      const metaLine = document.createElement("div");
      metaLine.className = "topic-meta-line";

      const replyCount = typeof data.replyCount === "number" ? data.replyCount : 0;
      const baseTime = data.lastReplyAt && data.lastReplyAt.toDate
        ? data.lastReplyAt.toDate()
        : (data.createdAt && data.createdAt.toDate ? data.createdAt.toDate() : null);

      let lastText = "";
      if (baseTime) {
        lastText = baseTime.toLocaleString("tr-TR", {
          day: "2-digit",
          month: "2-digit",
          hour: "2-digit",
          minute: "2-digit"
        });
      }

      if (replyCount === 0) {
        metaLine.textContent = "HenÃ¼z yorum yok";
      } else {
        metaLine.textContent = `${replyCount} yorum â€¢ Son yorum: ${lastText}`;
      }

      wrapper.appendChild(headerRow);
      wrapper.appendChild(msg);
      wrapper.appendChild(metaLine);

      item.appendChild(wrapper);
      topicsContainer.appendChild(item);
    });
  });
</script>

</body>
</html>
